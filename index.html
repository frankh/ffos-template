<!DOCTYPE html>
<html>
	<head>
		<script src="js/lib/jquery-1.7.2.js"></script>
		<script>
			$(document).ready(function() {
				$('#install').click(function() {
					request = window.navigator.mozApps.install('/manifest.webapp');
					request.onsuccess = function () {
						// Save the App object that is returned
						var appRecord = this.result;
						alert('Installation successful!');
					};
					request.onerror = function () {
						// Display the error information from the DOMError object
						alert('Install failed, error: ' + this.error.name);
					};
				});

				$('#set-alarm').click(function() {
					var date = new Date();
					date.setSeconds(Math.min(date.getSeconds() + 3, 60));

					var request = navigator.mozAlarms.getAll();
					request.onsuccess = function (e) { 
						$.each(e.target.result, function() {
							navigator.mozAlarms.remove(this.id);
						});


						request = navigator.mozAlarms.add(new Date("May 9, 2013 01:45:00"), "ignoreTimezone", {foo:"bar1"});
						request.onsuccess = function(e) { console.log('set'); };
						request.onerror = function(e) { alert(e.target.error.name) };
						request = navigator.mozAlarms.add(new Date("May 9, 2013 00:45:00"), "ignoreTimezone", {foo:"bar2"});
						request.onsuccess = function(e) { console.log('set'); };
						request.onerror = function(e) { alert(e.target.error.name) };
						request = navigator.mozAlarms.add(new Date("May 9, 2013 01:45:00"), "honorTimezone", {foo:"bar3"});
						request.onsuccess = function(e) { console.log('set'); };
						request.onerror = function(e) { alert(e.target.error.name) };
						request = navigator.mozAlarms.add(new Date("May 9, 2013 00:45:00"), "honorTimezone", {foo:"bar4"});
						request.onsuccess = function(e) { console.log('set'); };
						request.onerror = function(e) { alert(e.target.error.name) };
						
						navigator.mozSetMessageHandler("alarm", function (message) {
							alert("alarm fired: " + JSON.stringify(message)); 
						});

						request = navigator.mozAlarms.getAll();
						request.onsuccess = function (e) { alert(JSON.stringify(e.target.result)); };
						request.onerror = function (e) { alert(e.target.error.name); };
						};

				});
				window.onerror = function(msg, url, line) {
					alert("Error: " + msg + "\nurl: " + url + "\nline #: " + line);
				};
			})
		</script>
	</head>
	<body>
		<h1>Hello, World!</h1>
		<button id='install'>Install</button>
		<button id='set-alarm'>Alarm</button>
	</body>
</html>